automation:
  - id: "1605457574856"
    alias: Alarm turn on alerts
    trigger:
      - platform: state
        entity_id: alarm_control_panel.alarm
    action:
      - service: >-
          {% if trigger.to_state.state == 'disarmed' -%} 
            input_boolean.turn_off
          {%- else -%}
            input_boolean.turn_on
          {%- endif %}
        data:
          entity_id: >-
            {% if trigger.to_state.state == 'armed_home' -%}
              input_boolean.notify_on_door_window_events, input_boolean.notify_on_motion_garage
            {%- else -%}
              input_boolean.notify_on_door_window_events, input_boolean.notify_on_motion, input_boolean.notify_on_motion_garage
            {%- endif %}

  - id: "1605533510025"
    alias: Alarm self arm home when disarmed
    trigger:
      - platform: state
        entity_id: 
          - binary_sensor.4_in_1_sensor_home_security_motion_detection_2
        from: "on"
        to: "off"
        for: 60
    condition:
      - condition: time
        after: "23:00:00"
        before: "04:00:00"
      - condition: state
        entity_id: alarm_control_panel.alarm
        state: disarmed
      - condition: state
        entity_id: input_boolean.guest_mode
        state: "off"
    action:
      - service: alarm_control_panel.alarm_arm_home
        data:
          entity_id: alarm_control_panel.alarm

  - id: "1605537922330"
    alias: Alarm self disarm when armed home
    trigger:
      - platform: state
        entity_id: 
          - binary_sensor.samjin_multi_fcd00d01_ias_zone
          - binary_sensor.samjin_multi_0e220d01_ias_zone
        from: "off"
        to: "on"
    condition:
      - condition: time
        after: "05:00:00"
        before: "12:00:00"
      - condition: state
        entity_id: alarm_control_panel.alarm
        state: armed_home
      - condition: state
        entity_id: input_boolean.guest_mode
        state: "off"
      - condition: template
        value_template: >-
          {{ 15 < (as_timestamp(utcnow()) - 
              as_timestamp(states.binary_sensor.4_in_1_sensor_home_security_motion_detection_2.last_changed)) }}
    action:
      - service: alarm_control_panel.alarm_disarm
        data:
          entity_id: alarm_control_panel.alarm